<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>client-cpp: Notification management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">client-cpp
   &#160;<span id="projectnumber">0.8.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('notification_management_page.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Notification management </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Copyright 2014-2016 CyberVision, Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at </p><pre class="fragment"> http://www.apache.org/licenses/LICENSE-2.0
</pre><p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<h1><a class="anchor" id="brief"></a>
Brief description</h1>
<p>The Kaa Notifications subsystem enables messages delivery from the Kaa cluster to endpoints (EP). It is based on auto-generated classes according to the topic's notification schema used during SDK generation.</p>
<p>Notification topics can be mandatory or optional. Mandatory topic notifications are delivered in an enforced manner. Optional topics require subscription.</p>
<p><b>It is the responsibility of the client code to register the topic update listener and subscribe to optional topics.</b></p>
<h1><a class="anchor" id="topics"></a>
Topics - usage examples</h1>
<h2><a class="anchor" id="available_topics"></a>
Get available topics</h2>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>kaa;</div>
<div class="line"></div>
<div class="line"><a class="code" href="classkaa_1_1IKaaClient.html">IKaaClient</a>&amp; kaaClient = Kaa::getKaaClient();</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span>&amp; topics = kaaClient.getTopics();</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> it : topics) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Id: &quot;</span> &lt;&lt; it.first &lt;&lt; <span class="stringliteral">&quot;, name: &quot;</span> &lt;&lt; it.second.name</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;, type: &quot;</span> &lt;&lt; <a class="code" href="classkaa_1_1LoggingUtils.html#a7f91b8ea253c55ffe1f18778105e4177">LoggingUtils::TopicSubscriptionTypeToString</a>(</div>
<div class="line">                      it.second.subscriptionType) &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="updates_of_available_topics"></a>
Updates on available topics</h2>
<p>To receive updates on available topics, do the following: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="INotificationTopicListListener_8hpp.html">kaa/notification/INotificationTopicListListener.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>BasicTopicUpdateListener : <span class="keyword">public</span> INotificationTopicListListener {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Callback is used when the new list of available topics is received. </span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onListUpdated(<span class="keyword">const</span> Topics&amp; newList) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; topic : newList) {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Id: &quot;</span> &lt;&lt; topic.id &lt;&lt; <span class="stringliteral">&quot;, name: &quot;</span> &lt;&lt; topic.name</div>
<div class="line">                      &lt;&lt; <span class="stringliteral">&quot;, type: &quot;</span> &lt;&lt; LoggingUtils::TopicSubscriptionTypeToString(topic.subscriptionType) &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line">...</div>
<div class="line"><span class="comment">// Add listener to receive updates on available topics.</span></div>
<div class="line">std::unique_ptr&lt;BasicTopicUpdateListener&gt; topicUpdateListener(<span class="keyword">new</span> BasicTopicUpdateListener);</div>
<div class="line">kaaClient.addTopicListListener(*topicUpdateListener);</div>
<div class="line">...</div>
<div class="line"><span class="comment">// Remove the topic listener.</span></div>
<div class="line">kaaClient.removeTopicListListener(*topicUpdateListener);</div>
</div><!-- fragment --><h1><a class="anchor" id="notifications"></a>
Notifications - usage examples</h1>
<p>Assume, the notification schema has the following form: </p><div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;record&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;BasicNotification&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;namespace&quot;</span>: <span class="stringliteral">&quot;org.kaaproject.kaa.client.example&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;fields&quot;</span>: [</div>
<div class="line">        {</div>
<div class="line">            <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;body&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;string&quot;</span></div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>After calling avrogen.sh script Avro C++ compiler will be generated appropriate code and put it into NotificationGen.hpp header. So auto-generated notification class will be like: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>BasicNotification {</div>
<div class="line">    std::string body;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="global_listeners"></a>
General topic's notification listener(s)</h2>
<p>To receive notifications both on mandatory or on optional topics, do the following: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="INotificationListener_8hpp.html">kaa/notification/INotificationListener.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>BasicNotificationListener : <span class="keyword">public</span> INotificationListener {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onNotification(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> KaaNotification&amp; notification) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Received notification with body: &quot;</span> &lt;&lt; notification.body &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line">...</div>
<div class="line">std::unique_ptr&lt;BasicNotificationListener&gt; generalNotificationListener(<span class="keyword">new</span> BasicNotificationListener);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add the general listener.</span></div>
<div class="line">kaaClient.addNotificationListener(*generalNotificationListener);</div>
<div class="line">...</div>
<div class="line"><span class="comment">// Remove the general listener.</span></div>
<div class="line">kaaClient.removeNotificationListener(*generalNotificationListener);</div>
</div><!-- fragment --><h2><a class="anchor" id="specific_listener"></a>
Topic specific notification listener(s)</h2>
<p>To receive notifications on the specified topic, do the following: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="INotificationListener_8hpp.html">kaa/notification/INotificationListener.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>WeatherNotificationListener : <span class="keyword">public</span> INotificationListener {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onNotification(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> KaaNotification&amp; notification) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;What&#39;s weather: &quot;</span> &lt;&lt; notification.body &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>NewsNotificationListener : <span class="keyword">public</span> INotificationListener {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onNotification(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> KaaNotification&amp; notification) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;What&#39;s news: &quot;</span> &lt;&lt; notification.body &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add specific listeners both for news and weather topics</span></div>
<div class="line">std::unique_ptr&lt;WeatherNotificationListener&gt; weatherTopicListener(<span class="keyword">new</span> WeatherNotificationListener);</div>
<div class="line">std::unique_ptr&lt;NewsNotificationListener&gt; newsTopicListener(<span class="keyword">new</span> NewsNotificationListener);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add listener</span></div>
<div class="line">kaaClient.addNotificationListener(<span class="stringliteral">&quot;weather_topic_id&quot;</span>, *weatherTopicListener);</div>
<div class="line">kaaClient.addNotificationListener(<span class="stringliteral">&quot;news_topic_id&quot;</span>, *newsTopicListener);</div>
<div class="line">...</div>
<div class="line"><span class="comment">// Remove listener</span></div>
<div class="line">kaaClient.removeNotificationListener(<span class="stringliteral">&quot;weather_topic_id&quot;</span>, *weatherTopicListener);</div>
<div class="line">kaaClient.removeNotificationListener(<span class="stringliteral">&quot;news_topic_id&quot;</span>, *newsTopicListener);</div>
</div><!-- fragment --><h2><a class="anchor" id="optional_topics"></a>
Subscription to optional topics</h2>
<p>To receive notifications on the optional topic, do the following: </p><div class="fragment"><div class="line">kaaClient.subscribeToTopic(<span class="stringliteral">&quot;optional_topic_id&quot;</span>);</div>
</div><!-- fragment --><p>To stop receiving notifications on the optional topic, do the following: </p><div class="fragment"><div class="line">kaaClient.unsubscribeFromTopic(<span class="stringliteral">&quot;optional_topic_id&quot;</span>);</div>
</div><!-- fragment --><p>There are similar routines to deal with the group of optional topics: <a class="el" href="classkaa_1_1INotificationManager.html#a5a5f225a905ee7f0b9f10c5064709f14">kaa::INotificationManager::subscribeToTopics()</a> and <a class="el" href="classkaa_1_1INotificationManager.html#af92fa46a3aeedf6581d154b7d060073f">kaa::INotificationManager::unsubscribeFromTopics()</a> .</p>
<h2><a class="anchor" id="subscription_postponing"></a>
Subscription postponing</h2>
<p>There is an ability to postpone subscription requests. <b>It is a convenient way to do several subscription changes.</b><br />
 Consider the example: </p><div class="fragment"><div class="line"><span class="comment">// Do subscription changes with the false value for the forceSync parameter.</span></div>
<div class="line">kaaClient.subscribeToTopics({<span class="stringliteral">&quot;optional_topic1&quot;</span>, <span class="stringliteral">&quot;optional_topic2&quot;</span>, <span class="stringliteral">&quot;optional_topic3&quot;</span>}, <span class="keyword">false</span>);</div>
<div class="line">kaaClient.unsubscribeFromTopic(<span class="stringliteral">&quot;optional_topic4&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add notification listener(s) (optional).</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Send subscription requests.</span></div>
<div class="line">kaaClient.syncTopicSubscriptions();</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Kaa client C++ sdk</a></li>
    <li class="footer">Generated on Fri Feb 19 2016 16:12:29 for client-cpp by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
