<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>client-cpp: Notification management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">client-cpp
   &#160;<span id="projectnumber">0.6.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('notification_management_page.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Notification management </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="brief"></a>
Brief description</h1>
<p>The Kaa Notifications subsystem enables messages delivery from the Kaa cluster to endpoints (EP). It is based on auto-generated classes according to the topic's notification schema used during SDK generation.</p>
<p>Notification topics can be mandatory or optional. Mandatory topic notifications are delivered in an enforced manner. Optional topics require subscription. It is the responsibility of the client code to register the topic update listener and subscribe to optional topics.</p>
<h1><a class="anchor" id="topics"></a>
Topics - usage examples</h1>
<h2><a class="anchor" id="available_topics"></a>
Access to available topics</h2>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>kaa;</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Kaa initialization</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="classkaa_1_1IKaaClient.html">IKaaClient</a>&amp; kaaClient = <a class="code" href="classkaa_1_1Kaa.html#a43b389d718eae08dd7a7e6cea7f80e24">Kaa::getKaaClient</a>();</div>
<div class="line">INotificationManager&amp; notificationManager = kaaClient.getNotificationManager();</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span>&amp; topics = notificationManager.getTopics();</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> it : topics) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Id: &quot;</span> &lt;&lt; it.first &lt;&lt; <span class="stringliteral">&quot;, name: &quot;</span> &lt;&lt; it.second.name</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;, type: &quot;</span> &lt;&lt; <a class="code" href="classkaa_1_1LoggingUtils.html#a7f91b8ea253c55ffe1f18778105e4177">LoggingUtils::TopicSubscriptionTypeToString</a>(</div>
<div class="line">                      it.second.subscriptionType) &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="updates_of_available_topics"></a>
Updates of available topics</h2>
<p>If there is need to receive updates of available topic, do following: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="INotificationTopicListListener_8hpp.html">kaa/notification/INotificationTopicListListener.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>BasicTopicUpdateListener : <span class="keyword">public</span> INotificationTopicListListener {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Will be called on each update of the topic list </span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onListUpdated(<span class="keyword">const</span> Topics&amp; newList) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> topic : newList) {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Id: &quot;</span> &lt;&lt; topic.id &lt;&lt; <span class="stringliteral">&quot;, name: &quot;</span> &lt;&lt; topic.name</div>
<div class="line">                      &lt;&lt; <span class="stringliteral">&quot;, type: &quot;</span> &lt;&lt; LoggingUtils::TopicSubscriptionTypeToString(</div>
<div class="line">                              topic.subscriptionType) &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line">...</div>
<div class="line"><span class="comment">// Create and subscribe listener to receive topic list updates</span></div>
<div class="line">INotificationTopicListListenerPtr topicUpdateListener(<span class="keyword">new</span> BasicTopicUpdateListener);</div>
<div class="line">notificationManager.addTopicListListener(topicUpdateListener);</div>
<div class="line">...</div>
<div class="line"><span class="comment">// Remove topic update listener</span></div>
<div class="line">notificationManager.removeTopicListListener(topicUpdateListener);</div>
</div><!-- fragment --><h1><a class="anchor" id="notifications"></a>
Notifications - usage examples</h1>
<p>In order to receive notifications, both mandatory or optional, at least one listener should be added. A particular listener may be added for a specified topic as well.</p>
<p>Assume, notification schema has the following form: </p><div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;record&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;BasicNotification&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;namespace&quot;</span>: <span class="stringliteral">&quot;org.kaaproject.kaa.client.example&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;fields&quot;</span>: [</div>
<div class="line">        {</div>
<div class="line">            <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;body&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;string&quot;</span></div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>After calling avrogen.sh script Avro C++ compiler will be generated appropriate code and put it into NotificationGen.hpp header. So auto-generated notification class will be like: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>BasicNotification {</div>
<div class="line">    std::string body;</div>
<div class="line">};</div>
</div><!-- fragment --><p>As mentioned earlier, there is two kind of topics - mandatory and optional. Further it will be discussed dealing with both of them.</p>
<h2><a class="anchor" id="global_listeners"></a>
Topic notification listener(s)</h2>
<p>In order to receive notifications from all available topics (both mandatory and subscribed optional), do following: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;kaa/gen/NotificationGen.hpp&quot;</span> <span class="comment">// auto-generated header</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="AbstractNotificationListener_8hpp.html">kaa/notification/AbstractNotificationListener.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>BasicNotificationListener : <span class="keyword">public</span> AbstractNotificationListener&lt;BasicNotification&gt; {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onNotification(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> BasicNotification&amp; notification) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Received notification with body: &quot;</span> &lt;&lt; notification.body &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line">...</div>
<div class="line">INotificationListenerPtr globalNotificationListener(<span class="keyword">new</span> BasicNotificationListener);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add listener</span></div>
<div class="line">notificationManager.addNotificationListener(globalNotificationListener);</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Remove listener</span></div>
<div class="line">notificationManager.removeNotificationListener(globalNotificationListener);</div>
</div><!-- fragment --><h2><a class="anchor" id="specific_listener"></a>
Topic specific listener(s)</h2>
<p>To add listener(s) for a specified topic, do following: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;kaa/gen/NotificationGen.hpp&quot;</span> <span class="comment">// auto-generated header</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="AbstractNotificationListener_8hpp.html">kaa/notification/AbstractNotificationListener.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>WheatherNotificationListener : <span class="keyword">public</span> AbstractNotificationListener&lt;BasicNotification&gt; {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onNotification(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> BasicNotification&amp; notification) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;What&#39;s weather: &quot;</span> &lt;&lt; notification.body &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>NewsNotificationListener : <span class="keyword">public</span> AbstractNotificationListener&lt;BasicNotification&gt; {</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> onNotification(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> BasicNotification&amp; notification) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;What&#39;s news: &quot;</span> &lt;&lt; notification.body &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add specific listeners both for news and weather topics</span></div>
<div class="line">INotificationListenerPtr weatherTopicListener(<span class="keyword">new</span> WheatherNotificationListener);</div>
<div class="line">INotificationListenerPtr newsTopicListener(<span class="keyword">new</span> NewsNotificationListener);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add listener</span></div>
<div class="line">notificationManager.addNotificationListener(<span class="stringliteral">&quot;wheather_topic_id&quot;</span>, weatherTopicListener);</div>
<div class="line">notificationManager.addNotificationListener(<span class="stringliteral">&quot;news_topic_id&quot;</span>, newsTopicListener);</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// Remove listener</span></div>
<div class="line">notificationManager.removeNotificationListener(<span class="stringliteral">&quot;wheather_topic_id&quot;</span>, weatherTopicListener);</div>
<div class="line">notificationManager.removeNotificationListener(<span class="stringliteral">&quot;news_topic_id&quot;</span>, newsTopicListener);</div>
</div><!-- fragment --><h2><a class="anchor" id="optional_topics"></a>
Optional topic (un)subscription</h2>
<p>To receive notifications relating to some optional topic, firstly you should to subscribe to this topic: </p><div class="fragment"><div class="line">notificationManager.subscribeToTopic(<span class="stringliteral">&quot;optional_topic_id&quot;</span>, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>Unsubscription: </p><div class="fragment"><div class="line">notificationManager.unsubscribeFromTopic(<span class="stringliteral">&quot;optional_topic_id&quot;</span>, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>There is a similar stuff to deal with a group of optional topics - <a class="el" href="">kaa::INotificationManager::subscribeToTopics()</a> and <a class="el" href="">kaa::INotificationManager#unsubscribeFromTopics()</a> .</p>
<h2><a class="anchor" id="subscription_performance"></a>
Performance</h2>
<p>To increase Kaa performance in case of several subsequent subscription changes and avoid possible race conditions, we recommend to use following approach: </p><div class="fragment"><div class="line"><span class="comment">// Make subscription changes with parameter forceSync set to false</span></div>
<div class="line">notificationManager.subscribeToTopics({<span class="stringliteral">&quot;optional_topic1&quot;</span>, <span class="stringliteral">&quot;optional_topic2&quot;</span>, <span class="stringliteral">&quot;optional_topic3&quot;</span>}, <span class="keyword">false</span>);</div>
<div class="line">notificationManager.unsubscribeFromTopic(<span class="stringliteral">&quot;optional_topic4&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add listener(s) (optional)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Commit changes</span></div>
<div class="line">notificationManager.sync();</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Kaa client C++ sdk</a></li>
    <li class="footer">Generated on Sat Nov 29 2014 00:46:13 for client-cpp by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
